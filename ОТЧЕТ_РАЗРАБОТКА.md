# –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞ –≠–∫–æ–ú–∞—Ä–∫–µ—Ç

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 16 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞:** –ê–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (MVP —Å—Ç–∞–¥–∏—è)

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [Executive Summary](#executive-summary)
2. [–ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ](#—á—Ç–æ-—É–∂–µ-—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
3. [–ü–ª–∞–Ω –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –ø–æ —Ñ–∞–∑–∞–º](#–ø–ª–∞–Ω-–¥–æ—Ä–∞–±–æ—Ç–∫–∏-–ø–æ-—Ñ–∞–∑–∞–º)
4. [–ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –≤–µ–∫—Ç–æ—Ä—ã –∞—Ç–∞–∫–∏](#–∞–Ω–∞–ª–∏–∑-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏-–∏-–≤–µ–∫—Ç–æ—Ä—ã-–∞—Ç–∞–∫–∏)
5. [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã](#–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-–ø—Ä–æ–±–ª–µ–º—ã)
6. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

---

## Executive Summary

### –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å: 60% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ MVP

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ë–î, —Å–µ—Ä–≤–µ—Ä, –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç)
- ‚úÖ –ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ backend API —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- ‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ Frontend —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø–ª–∞—Ç–µ–∂–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–ÆKassa)
- ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ (–°–î–≠–ö, Boxberry)
- ‚ùå –ù–µ—Ç —á–∞—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- ‚ö†Ô∏è  –ù–∞–π–¥–µ–Ω—ã 8 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚ö†Ô∏è  –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞—â–∏—Ç–∞ –æ—Ç CSRF –∞—Ç–∞–∫

---

## –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. Backend Infrastructure (100%)

#### 1.1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

- –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã —á–µ—Ä–µ–∑ Drizzle ORM
- –°—Ö–µ–º–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¢–ó (TODO.md)
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- –í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
```
‚úì users (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
‚úì user_roles (—Ä–æ–ª–∏)
‚úì categories (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
‚úì products (—Ç–æ–≤–∞—Ä—ã)
‚úì product_images (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
‚úì user_addresses (–∞–¥—Ä–µ—Å–∞)
‚úì user_payment_cards (–ø–ª–∞—Ç–µ–∂–Ω—ã–µ –∫–∞—Ä—Ç—ã)
‚úì promocodes (–ø—Ä–æ–º–æ–∫–æ–¥—ã)
‚úì promocode_usage (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤)
‚úì orders (–∑–∞–∫–∞–∑—ã)
‚úì cart_items (–∫–æ—Ä–∑–∏–Ω–∞)
‚úì wishlist_items (–∏–∑–±—Ä–∞–Ω–Ω–æ–µ)
‚úì comparison_items (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ)
‚úì support_messages (—Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏)
‚úì support_message_attachments (–≤–ª–æ–∂–µ–Ω–∏—è)
```

**Seed –¥–∞–Ω–Ω—ã–µ:**
- 4 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (admin + 3 –ø–æ–∫—É–ø–∞—Ç–µ–ª—è)
- 5 –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–æ–≤–∞—Ä–æ–≤
- 30 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
- 30 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤

#### 1.2. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (—Å —É—è–∑–≤–∏–º–æ—Å—Ç—è–º–∏)

**–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- JWT —Ç–æ–∫–µ–Ω—ã (7 –¥–Ω–µ–π —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è)
- Bcrypt —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (salt 10 —Ä–∞—É–Ω–¥–æ–≤)
- Email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Å —Ç–æ–∫–µ–Ω–∞–º–∏
- Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- RBAC (Role-Based Access Control)
- 4 —Ä–æ–ª–∏: admin, marketer, consultant, customer

**–ö–æ–¥ (server/auth.ts):**
```typescript
‚úì generateToken(userId: string): string
‚úì verifyToken(token: string): JWTPayload | null
‚úì hashPassword(password: string): Promise<string>
‚úì comparePassword(password: string, hash: string): Promise<boolean>
‚úì authenticateToken middleware
‚úì requireRole(...roles: string[]) middleware
```

#### 1.3. API Routes
**–°—Ç–∞—Ç—É—Å:** ‚úÖ 90% —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:**

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (5/5):**
- `POST /api/auth/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `GET /api/auth/verify-email` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email
- `POST /api/auth/login` - –í—Ö–æ–¥
- `GET /api/auth/me` - –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- `PUT /api/auth/profile` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
- `PUT /api/auth/password` - –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è

**–ê–¥—Ä–µ—Å–∞ (4/4):**
- `GET /api/addresses` - –°–ø–∏—Å–æ–∫ –∞–¥—Ä–µ—Å–æ–≤
- `POST /api/addresses` - –°–æ–∑–¥–∞—Ç—å –∞–¥—Ä–µ—Å
- `PUT /api/addresses/:id` - –û–±–Ω–æ–≤–∏—Ç—å
- `DELETE /api/addresses/:id` - –£–¥–∞–ª–∏—Ç—å

**–ü–ª–∞—Ç–µ–∂–Ω—ã–µ –∫–∞—Ä—Ç—ã (3/3):**
- `GET /api/payment-cards` - –°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç
- `POST /api/payment-cards` - –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç—É (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞)
- `DELETE /api/payment-cards/:id` - –£–¥–∞–ª–∏—Ç—å

**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (4/4):**
- `GET /api/categories` - –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `POST /api/categories` - –°–æ–∑–¥–∞—Ç—å (admin/marketer)
- `PUT /api/categories/:id` - –û–±–Ω–æ–≤–∏—Ç—å (admin/marketer)
- `DELETE /api/categories/:id` - –£–¥–∞–ª–∏—Ç—å (admin/marketer)

**–¢–æ–≤–∞—Ä—ã (6/6):**
- `GET /api/products` - –°–ø–∏—Å–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- `GET /api/products/:id` - –î–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞
- `POST /api/products` - –°–æ–∑–¥–∞—Ç—å (admin/marketer)
- `PUT /api/products/:id` - –û–±–Ω–æ–≤–∏—Ç—å (admin/marketer)
- `DELETE /api/products/:id` - –£–¥–∞–ª–∏—Ç—å (admin/marketer)
- `POST /api/products/:id/images` - –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `DELETE /api/products/images/:id` - –£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

**–ö–æ—Ä–∑–∏–Ω–∞ (5/5):**
- `GET /api/cart` - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–∑–∏–Ω—ã
- `POST /api/cart` - –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
- `PUT /api/cart/:productId` - –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
- `DELETE /api/cart/:productId` - –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä
- `DELETE /api/cart` - –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É

**–ò–∑–±—Ä–∞–Ω–Ω–æ–µ (3/3):**
- `GET /api/wishlist`
- `POST /api/wishlist`
- `DELETE /api/wishlist/:productId`

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ (3/3):**
- `GET /api/comparison`
- `POST /api/comparison`
- `DELETE /api/comparison/:productId`

**–ó–∞–∫–∞–∑—ã (3/3):**
- `GET /api/orders` - –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤
- `GET /api/orders/:id` - –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
- `POST /api/orders` - –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
- `PUT /api/orders/:id/status` - –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å (admin)

**–ü—Ä–æ–º–æ–∫–æ–¥—ã (4/4):**
- `POST /api/promocodes/validate` - –í–∞–ª–∏–¥–∞—Ü–∏—è
- `GET /api/promocodes` - –°–ø–∏—Å–æ–∫ (admin/marketer)
- `POST /api/promocodes` - –°–æ–∑–¥–∞—Ç—å (admin/marketer)
- `PUT /api/promocodes/:id` - –û–±–Ω–æ–≤–∏—Ç—å (admin/marketer)
- `DELETE /api/promocodes/:id` - –£–¥–∞–ª–∏—Ç—å (admin)

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞ (3/3):**
- `GET /api/support/messages` - –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- `POST /api/support/messages` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
- `POST /api/support/messages/:id/attachments` - –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–ª–æ–∂–µ–Ω–∏—è

**–ê–¥–º–∏–Ω (2/2):**
- `GET /api/admin/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `GET /api/admin/users` - –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**WebSocket:**
- `/ws` - Real-time —á–∞—Ç (—á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)

#### 1.4. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–ë–æ–Ω—É—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (server/bonuses.ts):**
```typescript
‚úì calculateCashback() - –†–∞—Å—á–µ—Ç –∫–µ—à–±—ç–∫–∞
  - < 1000‚ÇΩ ‚Üí 3%
  - 1000-2499‚ÇΩ ‚Üí 5%
  - 2500-9999‚ÇΩ ‚Üí 7%
  - ‚â• 10000‚ÇΩ ‚Üí 10%
  - –ù–µ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤/–±–æ–Ω—É—Å–æ–≤

‚úì canUseBonuses() - –ú–∞–∫—Å–∏–º—É–º 20% –æ—Ç —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞
```

**–ü—Ä–æ–º–æ–∫–æ–¥—ã (server/promocodes.ts):**
```typescript
‚úì validatePromocode() - –ü–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è:
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π/–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—É–º–º—ã
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö)
  
‚úì applyPromocode() - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:
  - –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ: —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –ë–î
  - –í—Ä–µ–º–µ–Ω–Ω—ã–µ: –∑–∞–ø–∏—Å—å –≤ promocode_usage
```

**–§–∞–π–ª–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (server/upload.ts):**
```typescript
‚úì productImagesUpload - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
  - –§–æ—Ä–º–∞—Ç—ã: JPEG, PNG, WEBP
  - –ú–∞–∫—Å–∏–º—É–º: 10 –ú–ë –Ω–∞ —Ñ–∞–π–ª
  
‚úì chatAttachmentsUpload - –í–ª–æ–∂–µ–Ω–∏—è –≤ —á–∞—Ç
  - –î–æ 7 —Ñ–∞–π–ª–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
  - 10 –ú–ë –Ω–∞ —Ñ–∞–π–ª, 40 –ú–ë –æ–±—â–∏–π –ª–∏–º–∏—Ç
```

### 2. Frontend (80%)

#### 2.1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Shadcn UI –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω

**–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (45+):**
- ‚úì –§–æ—Ä–º—ã: Button, Input, Textarea, Select, Checkbox, Radio, Switch
- ‚úì –ù–∞–≤–∏–≥–∞—Ü–∏—è: Tabs, Sidebar, Navigation Menu, Breadcrumb
- ‚úì Feedback: Toast, Alert, Dialog, Alert Dialog, Progress
- ‚úì Data Display: Card, Table, Badge, Avatar, Separator
- ‚úì Overlays: Dropdown, Popover, Tooltip, Sheet, Drawer
- ‚úì Advanced: Calendar, Carousel, Command, Chart

#### 2.2. –°—Ç—Ä–∞–Ω–∏—Ü—ã
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã (18/18)

**–ü—É–±–ª–∏—á–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
- ‚úì `home-page.tsx` - –ì–ª–∞–≤–Ω–∞—è
- ‚úì `catalog-page.tsx` - –ö–∞—Ç–∞–ª–æ–≥
- ‚úì `product-detail-page.tsx` - –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞
- ‚úì `login-page.tsx` - –í—Ö–æ–¥
- ‚úì `register-page.tsx` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- ‚úì `verify-email-page.tsx` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email

**–ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
- ‚úì `cart-page.tsx` - –ö–æ—Ä–∑–∏–Ω–∞
- ‚úì `checkout-page.tsx` - –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- ‚úì `profile-page.tsx` - –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
- ‚úì `wishlist-page.tsx` - –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
- ‚úì `comparison-page.tsx` - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

**–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:**
- ‚úì `admin/dashboard-page.tsx` - –î–∞—à–±–æ—Ä–¥
- ‚úì `admin/users-page.tsx` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- ‚úì `admin/products-page.tsx` - –¢–æ–≤–∞—Ä—ã
- ‚úì `admin/categories-page.tsx` - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
- ‚úì `admin/promocodes-page.tsx` - –ü—Ä–æ–º–æ–∫–æ–¥—ã
- ‚úì `admin/orders-page.tsx` - –ó–∞–∫–∞–∑—ã

**404:**
- ‚úì `not-found.tsx`

#### 2.3. Hooks (React Query)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã

- ‚úì `useAuth.ts` - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úì `useProducts.ts` - –¢–æ–≤–∞—Ä—ã
- ‚úì `useCategories.ts` - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
- ‚úì `useCart.ts` - –ö–æ—Ä–∑–∏–Ω–∞
- ‚úì `useWishlist.ts` - –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
- ‚úì `useComparison.ts` - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ
- ‚úì `useOrders.ts` - –ó–∞–∫–∞–∑—ã
- ‚úì `usePromocodes.ts` - –ü—Ä–æ–º–æ–∫–æ–¥—ã
- ‚úì `useAddresses.ts` - –ê–¥—Ä–µ—Å–∞

#### 2.4. State Management
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Zustand –Ω–∞—Å—Ç—Ä–æ–µ–Ω

- ‚úì `authStore.ts` - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úì `cartStore.ts` - –ö–æ—Ä–∑–∏–Ω–∞ (–∫–ª–∏–µ–Ω—Ç—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)

#### 2.5. –†–æ—É—Ç–∏–Ω–≥
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Wouter –Ω–∞—Å—Ç—Ä–æ–µ–Ω

- ‚úì –ü—É–±–ª–∏—á–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
- ‚úì –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã (ProtectedRoute wrapper)
- ‚úì –ê–¥–º–∏–Ω –º–∞—Ä—à—Ä—É—Ç—ã —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–æ–ª–µ–π
- ‚úì 404 —Å—Ç—Ä–∞–Ω–∏—Ü–∞

---

## –ü–ª–∞–Ω –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –ø–æ —Ñ–∞–∑–∞–º

### üî¥ –§–ê–ó–ê 1: –ö–†–ò–¢–ò–ß–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í–´–°–®–ò–ô)

**–°—Ä–æ–∫:** 1-2 –¥–Ω—è  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É, –Ω–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

#### 1.1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å JWT
**–ü—Ä–æ–±–ª–µ–º–∞:** JWT_SECRET –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ  
**–§–∞–π–ª:** `server/auth.ts:5`

```typescript
// –°–ï–ô–ß–ê–° (–û–ü–ê–°–ù–û):
const JWT_SECRET = process.env.JWT_SECRET || "your-secret-key-change-in-production";

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
if (!process.env.JWT_SECRET) {
  throw new Error("JWT_SECRET environment variable is required");
}
const JWT_SECRET = process.env.JWT_SECRET;
```

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∏–ª—å–Ω—ã–π JWT_SECRET (32+ —Å–∏–º–≤–æ–ª–æ–≤)
2. –î–æ–±–∞–≤–∏—Ç—å –≤ `.env`
3. –£–¥–∞–ª–∏—Ç—å fallback –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –∫–æ–¥–∞

#### 1.2. CSRF Protection
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç CSRF –∞—Ç–∞–∫  
**–§–∞–π–ª—ã:** `server/index.ts`, `server/routes.ts`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
npm install csurf cookie-parser
```

```typescript
// server/index.ts
import cookieParser from 'cookie-parser';
import csrf from 'csurf';

app.use(cookieParser());
const csrfProtection = csrf({ cookie: true });

// –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ –≤—Å–µ–º POST/PUT/DELETE
app.use('/api', csrfProtection);
```

#### 1.3. Rate Limiting
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç brute-force –∞—Ç–∞–∫  
**–§–∞–π–ª:** `server/index.ts`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
npm install express-rate-limit
```

```typescript
import rateLimit from 'express-rate-limit';

const authLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 –º–∏–Ω—É—Ç
  max: 5, // 5 –ø–æ–ø—ã—Ç–æ–∫
  message: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.',
});

app.use('/api/auth/login', authLimiter);
app.use('/api/auth/register', authLimiter);
```

#### 1.4. Security Headers
**–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤–∞–∂–Ω—ã–µ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏  
**–§–∞–π–ª:** `server/index.ts`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
npm install helmet
```

```typescript
import helmet from 'helmet';

app.use(helmet({
  contentSecurityPolicy: {
    directives: {
      defaultSrc: ["'self'"],
      scriptSrc: ["'self'", "'unsafe-inline'"],
      styleSrc: ["'self'", "'unsafe-inline'"],
      imgSrc: ["'self'", "data:", "https:"],
    },
  },
}));
```

#### 1.5. Input Sanitization
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ —Å–∞–Ω–∏—Ç–∏–∑–∏—Ä—É—é—Ç—Å—è  
**–§–∞–π–ª:** `server/storage.ts:239-241`

```typescript
// –î–û–ë–ê–í–ò–¢–¨ –í–ê–õ–ò–î–ê–¶–ò–Æ:
if (filters?.search) {
  // –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–ª–∏–Ω—É
  const sanitizedSearch = filters.search.slice(0, 100);
  // –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è LIKE
  const escapedSearch = sanitizedSearch.replace(/[%_]/g, '\\$&');
  conditions.push(
    or(
      like(products.name, `%${escapedSearch}%`),
      like(products.description, `%${escapedSearch}%`)
    )!
  );
}
```

#### 1.6. WebSocket Authentication
**–ü—Ä–æ–±–ª–µ–º–∞:** WebSocket —Ç–æ–∫–µ–Ω—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ URL  
**–§–∞–π–ª:** `server/routes.ts:35`

**–õ—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**
```typescript
// –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ç–æ–∫–µ–Ω –≤ –ø–µ—Ä–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏, –∞ –Ω–µ –≤ URL
wss.on("connection", async (ws: any) => {
  let authenticated = false;
  let userId: string;
  
  const authTimeout = setTimeout(() => {
    if (!authenticated) {
      ws.close(1008, "Authentication timeout");
    }
  }, 5000);
  
  ws.on("message", async (data: any) => {
    const message = JSON.parse(data.toString());
    
    if (!authenticated) {
      if (message.type !== "auth") {
        ws.close(1008, "Authentication required");
        return;
      }
      
      const payload = verifyToken(message.token);
      if (!payload) {
        ws.close(1008, "Invalid token");
        return;
      }
      
      userId = payload.userId;
      authenticated = true;
      clearTimeout(authTimeout);
      ws.send(JSON.stringify({ type: "auth_success" }));
      return;
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π...
  });
});
```

#### 1.7. File Upload Validation
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–∞–±–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤  
**–§–∞–π–ª:** `server/upload.ts:50-63`

```typescript
// –£–°–ò–õ–ò–¢–¨ –ü–†–û–í–ï–†–ö–£:
import fileType from 'file-type';

fileFilter: async (req, file, cb) => {
  const allowedMimeTypes = ['image/jpeg', 'image/png', 'image/webp'];
  
  if (!allowedMimeTypes.includes(file.mimetype)) {
    return cb(new Error('–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞'));
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞ (magic bytes)
  const buffer = await file.buffer;
  const type = await fileType.fromBuffer(buffer);
  
  if (!type || !allowedMimeTypes.includes(type.mime)) {
    return cb(new Error('–§–∞–π–ª –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞—è–≤–ª–µ–Ω–Ω–æ–º—É —Ç–∏–ø—É'));
  }
  
  cb(null, true);
}
```

#### 1.8. –£—Ç–µ—á–∫–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–µ–∫-—Ç—Ä–µ–π—Å—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É  
**–§–∞–π–ª:** `server/index.ts:52-57`

```typescript
// –°–ï–ô–ß–ê–° (–û–ü–ê–°–ù–û):
app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {
  const status = err.status || err.statusCode || 500;
  const message = err.message || "Internal Server Error";
  res.status(status).json({ message });
  throw err; // –û–ø–∞—Å–Ω–æ!
});

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
app.use((err: any, req: Request, res: Response, _next: NextFunction) => {
  const status = err.status || err.statusCode || 500;
  
  // –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
  console.error('Error:', {
    message: err.message,
    stack: err.stack,
    path: req.path,
    method: req.method,
  });
  
  // –ö–ª–∏–µ–Ω—Ç—É –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –º–∏–Ω–∏–º—É–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
  const message = status === 500 
    ? "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞" 
    : err.message;
    
  res.status(status).json({ message });
});
```

---

### üü† –§–ê–ó–ê 2: –ó–ê–í–ï–†–®–ï–ù–ò–ï CORE –§–£–ù–ö–¶–ò–û–ù–ê–õ–ê (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í–´–°–û–ö–ò–ô)

**–°—Ä–æ–∫:** 3-5 –¥–Ω–µ–π  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ë–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫ MVP

#### 2.1. Email –æ—Ç–ø—Ä–∞–≤–∫–∞
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–ü—Ä–æ–±–ª–µ–º—ã:**
- `server/email.ts` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SMTP
- –ù–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è email —Å–µ—Ä–≤–∏—Å–∞

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –í—ã–±—Ä–∞—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (Mailgun, SendGrid, –∏–ª–∏ SMTP)
2. –î–æ–±–∞–≤–∏—Ç—å –≤ `.env`:
   ```
   EMAIL_HOST=smtp.example.com
   EMAIL_PORT=587
   EMAIL_USER=your-email@example.com
   EMAIL_PASSWORD=your-password
   EMAIL_FROM="–≠–∫–æ–ú–∞—Ä–∫–µ—Ç <noreply@ecomarket.ru>"
   SITE_URL=https://your-domain.com
   ```
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É email

#### 2.2. –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ç–æ–≤–∞—Ä–æ–≤
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ö–æ–¥ –µ—Å—Ç—å, –Ω–æ –Ω–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω

**–§–∞–π–ª:** `server/upload.ts`

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –ü–∞–ø–∫–∞ `uploads/products` —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –∑–∞–ø–∏—Å—å
3. –ü—É—Ç—å –∫ —Ñ–∞–π–ª–∞–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤ –ë–î
4. –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞

**–¢–µ—Å—Ç:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
mkdir -p uploads/products uploads/chat

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø
curl -F "images=@test.jpg" http://localhost:5000/api/products/1/images
```

#### 2.3. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ù–æ –Ω–µ—Ç —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –°–î–≠–ö/Boxberry –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)

**–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–¥–ª—è MVP):**
```typescript
// –í server/routes.ts –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞:
const deliveryCost = 300; // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```

**–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**
‚Üí –°–º. –§–∞–∑–∞ 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

#### 2.4. WebSocket —á–∞—Ç
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- WebSocket —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
- –ë–∞–∑–æ–≤–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

**–ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤—Å–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º (–Ω–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ø–æ –¥–∏–∞–ª–æ–≥–∞–º)
- –ù–µ—Ç –ø–æ–º–µ—Ç–∫–∏ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
- –ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```typescript
// server/routes.ts
interface AuthenticatedWebSocket extends WebSocket {
  userId?: string;
  isConsultant?: boolean;
}

const clients = new Map<string, AuthenticatedWebSocket>();

wss.on("connection", async (ws: AuthenticatedWebSocket, req: any) => {
  // ... –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ...
  
  ws.userId = userId;
  clients.set(userId, ws);
  
  // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π
  const messages = await storage.getSupportMessages(userId);
  ws.send(JSON.stringify({
    type: "history",
    messages,
  }));
  
  ws.on("message", async (data: any) => {
    const message = JSON.parse(data.toString());
    
    if (message.type === "chat_message") {
      const supportMessage = await storage.createSupportMessage({
        userId: ws.userId!,
        senderId: ws.userId!,
        messageText: message.text,
      });
      
      // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –¥–∏–∞–ª–æ–≥–∞
      const targetWs = clients.get(userId);
      if (targetWs?.readyState === WebSocket.OPEN) {
        targetWs.send(JSON.stringify({
          type: "new_message",
          message: supportMessage,
        }));
      }
      
      // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞–º
      for (const [clientId, clientWs] of clients.entries()) {
        if (clientWs.isConsultant && clientWs.readyState === WebSocket.OPEN) {
          clientWs.send(JSON.stringify({
            type: "new_message",
            message: supportMessage,
          }));
        }
      }
    }
  });
  
  ws.on("close", () => {
    clients.delete(userId);
  });
});
```

#### 2.5. –ê–¥–º–∏–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è Endpoint –µ—Å—Ç—å, –Ω–æ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞

**–§–∞–π–ª:** `server/routes.ts` (–Ω–∞–π—Ç–∏ `/api/admin/stats`)

**–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã:**
```typescript
app.get("/api/admin/stats", authenticateToken, requireRole("admin", "marketer"), async (req, res) => {
  try {
    const { period = 'all' } = req.query; // 'day', 'week', 'month', 'all'
    
    let startDate: Date | undefined;
    const now = new Date();
    
    switch (period) {
      case 'day':
        startDate = new Date(now.setHours(0, 0, 0, 0));
        break;
      case 'week':
        startDate = new Date(now.setDate(now.getDate() - 7));
        break;
      case 'month':
        startDate = new Date(now.setMonth(now.getMonth() - 1));
        break;
    }
    
    // –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞
    const ordersQuery = startDate 
      ? db.select().from(orders).where(
          and(
            gte(orders.createdAt, startDate),
            eq(orders.paymentStatus, 'paid')
          )
        )
      : db.select().from(orders).where(eq(orders.paymentStatus, 'paid'));
    
    const allOrders = await ordersQuery;
    const totalRevenue = allOrders.reduce((sum, o) => sum + parseFloat(o.total), 0);
    const orderCount = allOrders.length;
    const averageCheck = orderCount > 0 ? totalRevenue / orderCount : 0;
    
    // –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
    const usersQuery = startDate
      ? db.select().from(users).where(gte(users.createdAt, startDate))
      : db.select().from(users);
    const newUsers = await usersQuery;
    
    // –¢–æ–ø —Ç–æ–≤–∞—Ä—ã
    const topProducts = await db.execute(sql`
      SELECT 
        p.id,
        p.name,
        COUNT(DISTINCT o.id) as sales_count,
        SUM(CAST((items->>'quantity') AS INTEGER)) as total_quantity,
        SUM(CAST((items->>'price') AS DECIMAL) * CAST((items->>'quantity') AS INTEGER)) as revenue
      FROM orders o,
      LATERAL json_array_elements(o.items::json) items
      JOIN products p ON p.id = (items->>'productId')::uuid
      WHERE o.payment_status = 'paid'
      ${startDate ? sql`AND o.created_at >= ${startDate}` : sql``}
      GROUP BY p.id, p.name
      ORDER BY revenue DESC
      LIMIT 10
    `);
    
    res.json({
      totalRevenue,
      orderCount,
      averageCheck,
      newUsersCount: newUsers.length,
      topProducts,
    });
  } catch (error) {
    console.error('Stats error:', error);
    res.status(500).json({ message: "–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏" });
  }
});
```

#### 2.6. Frontend: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è API
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –°—Ç—Ä–∞–Ω–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã, –Ω–æ –º–Ω–æ–≥–∏–µ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ API
- –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- –ù–µ—Ç loading —Å–æ—Å—Ç–æ—è–Ω–∏–π

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∂–¥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É:**
1. `catalog-page.tsx` - —Ñ–∏–ª—å—Ç—Ä—ã, –ø–∞–≥–∏–Ω–∞—Ü–∏—è
2. `product-detail-page.tsx` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–∞, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É
3. `cart-page.tsx` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞, —É–¥–∞–ª–µ–Ω–∏–µ
4. `checkout-page.tsx` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
5. `profile-page.tsx` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è, –∞–¥—Ä–µ—Å–∞
6. –ê–¥–º–∏–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏

**–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
```typescript
// catalog-page.tsx
import { useProducts } from '@/hooks/useProducts';
import { LoadingState } from '@/components/loading-state';
import { EmptyState } from '@/components/empty-state';

export default function CatalogPage() {
  const [filters, setFilters] = useState({});
  const { data, isLoading, error } = useProducts(filters);
  
  if (isLoading) return <LoadingState />;
  if (error) return <div>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤</div>;
  if (!data?.products.length) return <EmptyState />;
  
  return (
    <div>
      {/* –§–∏–ª—å—Ç—Ä—ã */}
      <div>...</div>
      
      {/* –¢–æ–≤–∞—Ä—ã */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        {data.products.map(product => (
          <ProductCard key={product.id} product={product} />
        ))}
      </div>
      
      {/* –ü–∞–≥–∏–Ω–∞—Ü–∏—è */}
      <Pagination 
        page={data.page}
        totalPages={data.totalPages}
        onPageChange={(page) => setFilters({...filters, page})}
      />
    </div>
  );
}
```

---

### üü° –§–ê–ó–ê 3: –£–õ–£–ß–®–ï–ù–ò–Ø UX (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°–†–ï–î–ù–ò–ô)

**–°—Ä–æ–∫:** 2-3 –¥–Ω—è  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –í–∞–∂–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞

#### 3.1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –°–æ–∑–¥–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π error boundary
2. –î–æ–±–∞–≤–∏—Ç—å toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –æ—à–∏–±–æ–∫ API
3. –°—Ç—Ä–∞–Ω–∏—Ü—ã –æ—à–∏–±–æ–∫ (500, 403, 404)

```typescript
// client/src/components/error-boundary.tsx
import { Component, ReactNode } from 'react';

export class ErrorBoundary extends Component<
  { children: ReactNode },
  { hasError: boolean }
> {
  state = { hasError: false };
  
  static getDerivedStateFromError() {
    return { hasError: true };
  }
  
  componentDidCatch(error: Error, errorInfo: any) {
    console.error('Error caught:', error, errorInfo);
  }
  
  render() {
    if (this.state.hasError) {
      return (
        <div className="flex items-center justify-center h-screen">
          <div className="text-center">
            <h1 className="text-4xl font-bold mb-4">–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫</h1>
            <button
              onClick={() => window.location.reload()}
              className="btn btn-primary"
            >
              –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
            </button>
          </div>
        </div>
      );
    }
    
    return this.props.children;
  }
}
```

#### 3.2. Loading —Å–æ—Å—Ç–æ—è–Ω–∏—è
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç Skeleton –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
2. –î–æ–±–∞–≤–∏—Ç—å Suspense –≥—Ä–∞–Ω–∏—Ü—ã
3. –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –º—É—Ç–∞—Ü–∏–π

```typescript
// client/src/components/loading-state.tsx
export function ProductCardSkeleton() {
  return (
    <div className="border rounded-lg p-4 animate-pulse">
      <div className="bg-gray-200 h-48 rounded mb-4" />
      <div className="bg-gray-200 h-6 rounded mb-2" />
      <div className="bg-gray-200 h-4 rounded w-2/3" />
    </div>
  );
}

export function ProductListSkeleton() {
  return (
    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
      {Array.from({ length: 6 }).map((_, i) => (
        <ProductCardSkeleton key={i} />
      ))}
    </div>
  );
}
```

#### 3.3. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (—Ç–æ–ª—å–∫–æ Zod —Å—Ö–µ–º—ã)

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –°—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –µ—Å—Ç—å –≤ `shared/schema.ts`
- –ù–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–µ –≤—Å–µ–≥–¥–∞ –∏—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç
- –ù–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –æ–± –æ—à–∏–±–∫–∞—Ö

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å React Hook Form –≤–µ–∑–¥–µ
2. –î–æ–±–∞–≤–∏—Ç—å zod resolver
3. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –ø–æ–¥ –ø–æ–ª—è–º–∏

```typescript
// –ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ñ–æ—Ä–º—ã
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { registerSchema } from '@shared/schema';

export function RegisterForm() {
  const { register, handleSubmit, formState: { errors } } = useForm({
    resolver: zodResolver(registerSchema),
  });
  
  const onSubmit = async (data) => {
    // ...
  };
  
  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <div>
        <label>Email</label>
        <input {...register('email')} />
        {errors.email && <span className="text-red-500">{errors.email.message}</span>}
      </div>
      {/* ... */}
    </form>
  );
}
```

#### 3.4. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –≤—Å–µ—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è—Ö:**
- Mobile (320px - 768px)
- Tablet (768px - 1024px)
- Desktop (1024px+)

**–û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ:**
1. –¢–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª)
2. –ê–¥–º–∏–Ω —Ç–∞–±–ª–∏—Ü—ã (responsive columns)
3. –§–æ—Ä–º—ã (—Å—Ç–µ–∫–∞–Ω–∏–µ –≤ 1 –∫–æ–ª–æ–Ω–∫—É)
4. –ù–∞–≤–∏–≥–∞—Ü–∏—è (–º–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é)

#### 3.5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–î–µ–π—Å—Ç–≤–∏—è:**
1. Lazy loading –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–Ω–∏–∞—Ç—é—Ä (thumbnails)
3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ (WebP)

```typescript
// server/upload.ts
import sharp from 'sharp';

// –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
const processImage = async (filePath: string) => {
  const outputPath = filePath.replace(/\.(jpg|png)$/, '.webp');
  const thumbnailPath = filePath.replace(/\.(jpg|png)$/, '_thumb.webp');
  
  // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ WebP
  await sharp(filePath)
    .webp({ quality: 80 })
    .toFile(outputPath);
  
  // –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–Ω–∏–∞—Ç—é—Ä—ã
  await sharp(filePath)
    .resize(300, 300, { fit: 'inside' })
    .webp({ quality: 70 })
    .toFile(thumbnailPath);
  
  return { fullPath: outputPath, thumbPath: thumbnailPath };
};
```

```typescript
// client: Lazy loading
<img 
  src={product.thumbnailUrl} 
  loading="lazy"
  alt={product.name}
/>
```

#### 3.6. SEO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–î–µ–π—Å—Ç–≤–∏—è:**
1. Meta —Ç–µ–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
2. Open Graph –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π
3. Sitemap.xml
4. robots.txt

```typescript
// client/src/components/seo.tsx
import { Helmet } from 'react-helmet-async';

export function SEO({ title, description, image, url }) {
  const siteTitle = "–≠–∫–æ–ú–∞—Ä–∫–µ—Ç - –ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã";
  const fullTitle = title ? `${title} | ${siteTitle}` : siteTitle;
  
  return (
    <Helmet>
      <title>{fullTitle}</title>
      <meta name="description" content={description} />
      
      {/* Open Graph */}
      <meta property="og:title" content={fullTitle} />
      <meta property="og:description" content={description} />
      <meta property="og:image" content={image} />
      <meta property="og:url" content={url} />
      
      {/* Twitter */}
      <meta name="twitter:card" content="summary_large_image" />
      <meta name="twitter:title" content={fullTitle} />
      <meta name="twitter:description" content={description} />
      <meta name="twitter:image" content={image} />
    </Helmet>
  );
}
```

---

### üîµ –§–ê–ó–ê 4: –ò–ù–¢–ï–ì–†–ê–¶–ò–ò (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ù–ï –ë–õ–û–ö–ò–†–£–ï–¢ MVP)

**–°—Ä–æ–∫:** 5-7 –¥–Ω–µ–π  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ MVP —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ü–µ–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏

#### 4.1. –ÆKassa (–ü–ª–∞—Ç–µ–∂–∏)
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**
- `server/yukassa.ts` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è SDK
- Webhook endpoint –≤ `server/routes.ts`

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
npm install @a2seven/yoo-checkout
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// server/yukassa.ts
import { YooCheckout } from '@a2seven/yoo-checkout';

if (!process.env.YUKASSA_SHOP_ID || !process.env.YUKASSA_SECRET_KEY) {
  throw new Error('YUKASSA credentials are required');
}

const checkout = new YooCheckout({
  shopId: process.env.YUKASSA_SHOP_ID!,
  secretKey: process.env.YUKASSA_SECRET_KEY!,
});

export async function createPayment(
  amount: number,
  orderId: string,
  returnUrl: string
) {
  return await checkout.createPayment({
    amount: {
      value: amount.toFixed(2),
      currency: 'RUB',
    },
    confirmation: {
      type: 'redirect',
      return_url: returnUrl,
    },
    capture: true,
    metadata: { orderId },
  });
}

export async function getPaymentInfo(paymentId: string) {
  return await checkout.getPayment(paymentId);
}

export async function createPaymentWithSaving(
  amount: number,
  orderId: string,
  returnUrl: string
) {
  return await checkout.createPayment({
    amount: {
      value: amount.toFixed(2),
      currency: 'RUB',
    },
    confirmation: {
      type: 'redirect',
      return_url: returnUrl,
    },
    capture: true,
    save_payment_method: true,
    metadata: { orderId },
  });
}
```

**Webhook –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π:**
```typescript
// server/routes.ts
app.post('/api/yukassa/webhook', async (req, res) => {
  try {
    const event = req.body;
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ (–≤–∞–∂–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!)
    const signature = req.headers['x-yookassa-signature'];
    // TODO: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å signature
    
    if (event.event === 'payment.succeeded') {
      const paymentId = event.object.id;
      const orderId = event.object.metadata.orderId;
      
      const order = await storage.getOrder(orderId);
      
      if (order && order.paymentStatus === 'pending') {
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
        await storage.updateOrder(orderId, {
          paymentStatus: 'paid',
          yukassaPaymentId: paymentId,
          paidAt: new Date(),
          status: 'paid',
        });
        
        // –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
        await storage.clearCart(order.userId);
        
        // –£–º–µ–Ω—å—à–∏—Ç—å –æ—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
        for (const item of order.items) {
          await storage.updateProduct(item.productId, {
            stockQuantity: sql`stock_quantity - ${item.quantity}`,
          });
        }
        
        // –ù–∞—á–∏—Å–ª–∏—Ç—å –±–æ–Ω—É—Å—ã
        if (order.bonusesEarned > 0) {
          await storage.updateUser(order.userId, {
            bonusBalance: sql`bonus_balance + ${order.bonusesEarned}`,
          });
        }
        
        // –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥
        if (order.promocodeId) {
          await applyPromocode(order.promocodeId, order.userId, orderId);
        }
      }
    }
    
    res.status(200).send('OK');
  } catch (error) {
    console.error('Webhook error:', error);
    res.status(500).send('Error');
  }
});
```

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```env
YUKASSA_SHOP_ID=your_shop_id
YUKASSA_SECRET_KEY=your_secret_key
```

#### 4.2. –°–î–≠–ö API (–î–æ—Å—Ç–∞–≤–∫–∞)
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–§–∞–π–ª:** `server/cdek.ts`

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
npm install axios
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// server/cdek.ts
import axios from 'axios';

const CDEK_API_URL = 'https://api.cdek.ru/v2';
const CDEK_CLIENT_ID = process.env.CDEK_CLIENT_ID;
const CDEK_CLIENT_SECRET = process.env.CDEK_CLIENT_SECRET;

let accessToken: string | null = null;
let tokenExpiry: number = 0;

async function getAccessToken() {
  if (accessToken && Date.now() < tokenExpiry) {
    return accessToken;
  }
  
  const response = await axios.post(`${CDEK_API_URL}/oauth/token`, {
    grant_type: 'client_credentials',
    client_id: CDEK_CLIENT_ID,
    client_secret: CDEK_CLIENT_SECRET,
  });
  
  accessToken = response.data.access_token;
  tokenExpiry = Date.now() + (response.data.expires_in - 60) * 1000;
  
  return accessToken;
}

export async function getDeliveryPoints(city: string) {
  const token = await getAccessToken();
  
  const response = await axios.get(`${CDEK_API_URL}/deliverypoints`, {
    headers: { Authorization: `Bearer ${token}` },
    params: {
      city,
      type: 'PVZ',
    },
  });
  
  return response.data;
}

export async function calculateDelivery(params: {
  fromCityCode: number;
  toCityCode: number;
  packages: Array<{
    weight: number; // –≥—Ä–∞–º–º—ã
    length: number; // —Å–º
    width: number;
    height: number;
  }>;
}) {
  const token = await getAccessToken();
  
  const response = await axios.post(
    `${CDEK_API_URL}/calculator/tarifflist`,
    {
      type: 1, // –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω
      currency: 1, // RUB
      from_location: { code: params.fromCityCode },
      to_location: { code: params.toCityCode },
      packages: params.packages,
    },
    {
      headers: { Authorization: `Bearer ${token}` },
    }
  );
  
  return response.data.tariff_codes.map((tariff: any) => ({
    code: tariff.tariff_code,
    name: tariff.tariff_name,
    cost: tariff.delivery_sum,
    estimatedDays: tariff.period_max,
  }));
}

export async function createOrder(orderData: any) {
  const token = await getAccessToken();
  
  const response = await axios.post(
    `${CDEK_API_URL}/orders`,
    orderData,
    {
      headers: { Authorization: `Bearer ${token}` },
    }
  );
  
  return response.data;
}
```

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```env
CDEK_CLIENT_ID=your_client_id
CDEK_CLIENT_SECRET=your_client_secret
```

**API Routes:**
```typescript
// server/routes.ts
app.post('/api/delivery/calculate', authenticateToken, async (req, res) => {
  try {
    const { city, items } = req.body;
    
    // –†–∞—Å—á–µ—Ç –≤–µ—Å–∞ –∏ –≥–∞–±–∞—Ä–∏—Ç–æ–≤
    const packages = [{
      weight: 1000, // TODO: —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏–∑ —Ç–æ–≤–∞—Ä–æ–≤
      length: 30,
      width: 20,
      height: 10,
    }];
    
    const cdekTariffs = await calculateDelivery({
      fromCityCode: 44, // –ú–æ—Å–∫–≤–∞ (–ø—Ä–∏–º–µ—Ä)
      toCityCode: city.code,
      packages,
    });
    
    res.json({ tariffs: cdekTariffs });
  } catch (error) {
    res.status(500).json({ message: "–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏" });
  }
});

app.get('/api/delivery/points', async (req, res) => {
  try {
    const { city } = req.query;
    const points = await getDeliveryPoints(city as string);
    res.json(points);
  } catch (error) {
    res.status(500).json({ message: "–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏" });
  }
});
```

#### 4.3. Boxberry API (–î–æ—Å—Ç–∞–≤–∫–∞)
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–§–∞–π–ª:** `server/boxberry.ts`

**–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –°–î–≠–ö, –Ω–æ —Å API Boxberry**

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://api.boxberry.ru/

#### 4.4. Cron –∑–∞–¥–∞—á–∏
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–§–∞–π–ª:** `server/cron.ts`

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
npm install node-cron
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// server/cron.ts
import cron from 'node-cron';
import { storage } from './storage';
import { getPaymentInfo } from './yukassa';

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–æ–≤ –∫–∞–∂–¥—ã–π —á–∞—Å
cron.schedule('0 * * * *', async () => {
  console.log('üïê –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤...');
  
  const pendingOrders = await storage.getOrders({
    status: 'pending',
    paymentMethod: 'online',
  });
  
  for (const order of pendingOrders) {
    if (order.yukassaPaymentId) {
      const payment = await getPaymentInfo(order.yukassaPaymentId);
      
      if (payment.status === 'succeeded' && order.paymentStatus === 'pending') {
        await storage.updateOrder(order.id, {
          paymentStatus: 'paid',
          paidAt: new Date(),
          status: 'paid',
        });
      }
    }
  }
});

// –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (—Ä–∞–∑ –≤ –¥–µ–Ω—å)
cron.schedule('0 2 * * *', async () => {
  console.log('üïê –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏...');
  
  await db.execute(sql`
    UPDATE users 
    SET verification_token = NULL,
        verification_token_expires = NULL
    WHERE verification_token_expires < NOW()
  `);
});
```

```typescript
// server/index.ts
import './cron'; // –ó–∞–ø—É—Å—Ç–∏—Ç—å cron –∑–∞–¥–∞—á–∏
```

---

### üü¢ –§–ê–ó–ê 5: –ü–†–û–î–ê–ö–®–ù-–ì–û–¢–û–í–ù–û–°–¢–¨ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ù–ò–ó–ö–ò–ô)

**–°—Ä–æ–∫:** 3-5 –¥–Ω–µ–π  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ MVP

#### 5.1. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
npm install winston
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// server/logger.ts
import winston from 'winston';

export const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ filename: 'logs/error.log', level: 'error' }),
    new winston.transports.File({ filename: 'logs/combined.log' }),
  ],
});

if (process.env.NODE_ENV !== 'production') {
  logger.add(new winston.transports.Console({
    format: winston.format.simple(),
  }));
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```typescript
import { logger } from './logger';

logger.info('User logged in', { userId: user.id });
logger.error('Payment failed', { orderId, error: error.message });
```

#### 5.2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
- Sentry –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫
- New Relic –¥–ª—è APM
- Prometheus + Grafana –¥–ª—è –º–µ—Ç—Ä–∏–∫

#### 5.3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤:**
1. Unit —Ç–µ—Å—Ç—ã (Jest)
2. Integration —Ç–µ—Å—Ç—ã (Supertest)
3. E2E —Ç–µ—Å—Ç—ã (Playwright)

#### 5.4. CI/CD
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**GitHub Actions workflow:**
```yaml
# .github/workflows/ci.yml
name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_PASSWORD: postgres
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
    
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '20'
      
      - run: npm ci
      - run: npm run check
      - run: npm run build
```

#### 5.5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**Swagger/OpenAPI:**
```bash
npm install swagger-jsdoc swagger-ui-express
```

#### 5.6. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã:**
```bash
#!/bin/bash
# scripts/backup-db.sh

DATE=$(date +%Y-%m-%d_%H-%M-%S)
pg_dump $DATABASE_URL > backups/db_$DATE.sql
```

**Cron:**
```
0 3 * * * /path/to/backup-db.sh
```

---

## –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –≤–µ–∫—Ç–æ—Ä—ã –∞—Ç–∞–∫–∏

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò

#### 1. JWT Secret
**–†–∏—Å–∫:** –í—ã—Å–æ–∫–∏–π  
**CVSS:** 9.1 (Critical)  
**–§–∞–π–ª:** `server/auth.ts:5`

**–û–ø–∏—Å–∞–Ω–∏–µ:**
JWT_SECRET –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞—Ç–∞–∫—É—é—â–µ–º—É –ø–æ–¥–¥–µ–ª–∞—Ç—å –ª—é–±–æ–π —Ç–æ–∫–µ–Ω.

**–≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è:**
```javascript
// –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω –¥–ª—è –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const jwt = require('jsonwebtoken');
const token = jwt.sign(
  { userId: 'admin-user-id' },
  'your-secret-key-change-in-production', // –î–µ—Ñ–æ–ª—Ç–Ω—ã–π —Å–µ–∫—Ä–µ—Ç
  { expiresIn: '7d' }
);
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
‚Üí –°–º. –§–∞–∑–∞ 1.1

---

#### 2. CSRF –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
**–†–∏—Å–∫:** –í—ã—Å–æ–∫–∏–π  
**CVSS:** 8.1 (High)  
**–§–∞–π–ª—ã:** –í—Å–µ POST/PUT/DELETE endpoints

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç Cross-Site Request Forgery –∞—Ç–∞–∫.

**–≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è:**
```html
<!-- –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ —Å–æ–∑–¥–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É: -->
<form action="https://ecomarket.ru/api/orders" method="POST" id="hack">
  <input name="items" value='[{"productId":"expensive-item","quantity":100}]'>
  <input name="deliveryService" value="cdek">
  <input name="paymentMethod" value="on_delivery">
</form>
<script>document.getElementById('hack').submit();</script>
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏ –ø–æ—Å–µ—Ç–∏—Ç —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É, –∑–∞–∫–∞–∑ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –æ—Ç –µ–≥–æ –∏–º–µ–Ω–∏.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
‚Üí –°–º. –§–∞–∑–∞ 1.2

---

#### 3. Rate Limiting –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
**–†–∏—Å–∫:** –°—Ä–µ–¥–Ω–∏–π  
**CVSS:** 6.5 (Medium)  
**–§–∞–π–ª—ã:** `/api/auth/login`, `/api/auth/register`

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ú–æ–∂–Ω–æ –ø—Ä–æ–≤–æ–¥–∏—Ç—å brute-force –∞—Ç–∞–∫–∏ –Ω–∞ –ø–∞—Ä–æ–ª–∏ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

**–≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è:**
```python
import requests

# –ü–µ—Ä–µ–±–æ—Ä –ø–∞—Ä–æ–ª–µ–π
for password in password_list:
    r = requests.post('https://ecomarket.ru/api/auth/login', json={
        'email': 'admin@ecomarket.ru',
        'password': password
    })
    if r.status_code == 200:
        print(f'Password found: {password}')
        break
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
‚Üí –°–º. –§–∞–∑–∞ 1.3

---

#### 4. WebSocket Token –≤ URL
**–†–∏—Å–∫:** –°—Ä–µ–¥–Ω–∏–π  
**CVSS:** 5.8 (Medium)  
**–§–∞–π–ª:** `server/routes.ts:35`

**–û–ø–∏—Å–∞–Ω–∏–µ:**
JWT —Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ URL WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —É—Ç–µ—á–∫–µ —á–µ—Ä–µ–∑:
- –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
- –õ–æ–≥–∏ –ø—Ä–æ–∫—Å–∏
- Browser history
- Referer headers

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```typescript
const token = new URL(req.url!, `http://${req.headers.host}`)
  .searchParams.get("token");
```

**URL –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:**
```
wss://ecomarket.ru/ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
‚Üí –°–º. –§–∞–∑–∞ 1.6

---

#### 5. –£—Ç–µ—á–∫–∞ Stack Traces
**–†–∏—Å–∫:** –°—Ä–µ–¥–Ω–∏–π  
**CVSS:** 5.3 (Medium)  
**–§–∞–π–ª:** `server/index.ts:52-57`

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°—Ç–µ–∫-—Ç—Ä–µ–π—Å—ã –º–æ–≥—É—Ç —Ä–∞—Å–∫—Ä—ã—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**–ü—Ä–∏–º–µ—Ä —É—Ç–µ—á–∫–∏:**
```json
{
  "message": "Cannot read property 'id' of undefined",
  "stack": "Error: Cannot read property 'id' of undefined\n    at /app/server/routes.ts:245:30\n    at processTicksAndRejections (internal/process/task_queues.js:95:5)"
}
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
‚Üí –°–º. –§–∞–∑–∞ 1.8

---

#### 6. –°–ª–∞–±–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
**–†–∏—Å–∫:** –°—Ä–µ–¥–Ω–∏–π  
**CVSS:** 5.0 (Medium)  
**–§–∞–π–ª:** `server/upload.ts:50-63`

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ MIME type, –Ω–æ –Ω–µ —Ä–µ–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞.

**–≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è:**
```bash
# –°–æ–∑–¥–∞—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π —Ñ–∞–π–ª —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º MIME
echo '<?php system($_GET["cmd"]); ?>' > shell.jpg
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å MIME: image/jpeg
curl -F "images=@shell.jpg" http://ecomarket.ru/api/products/1/images
```

**–ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç PHP, —Ä–∏—Å–∫ –º–µ–Ω—å—à–µ, –Ω–æ:**
- –í–æ–∑–º–æ–∂–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –æ–≥—Ä–æ–º–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (DoS)
- –ó–∞–≥—Ä—É–∑–∫–∞ SVG —Å XSS payload

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
‚Üí –°–º. –§–∞–∑–∞ 1.7

---

#### 7. SQL Injection (–Ω–∏–∑–∫–∏–π —Ä–∏—Å–∫)
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π  
**CVSS:** 4.0 (Low)  
**–§–∞–π–ª:** `server/storage.ts:239-241`

**–û–ø–∏—Å–∞–Ω–∏–µ:**
Drizzle ORM –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç SQL Injection, –Ω–æ LIKE –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –≤—ã–∑–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è DoS –∞—Ç–∞–∫–∞:**
```
GET /api/products?search=%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
–û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å `LIKE '%%%%%%%%%...%'`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
‚Üí –°–º. –§–∞–∑–∞ 1.5

---

#### 8. XSS —á–µ—Ä–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π  
**CVSS:** 3.7 (Low)  
**–§–∞–π–ª:** `server/routes.ts:57-61`

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –±–µ–∑ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏.

**–≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è:**
```javascript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:
ws.send(JSON.stringify({
  type: "chat_message",
  text: "<script>alert('XSS')</script>"
}));
```

**–ó–∞—â–∏—Ç–∞:**
React –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç, –ù–û:
- –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `dangerouslySetInnerHTML` - XSS –≤–æ–∑–º–æ–∂–µ–Ω
- –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ email - XSS –≤–æ–∑–º–æ–∂–µ–Ω

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```bash
npm install dompurify
```

```typescript
import DOMPurify from 'dompurify';

const sanitizedText = DOMPurify.sanitize(message.text);
```

---

### ‚ö†Ô∏è –°–†–ï–î–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´

#### 9. –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç –ø–µ—Ä–µ–±–æ—Ä–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
**–§–∞–π–ª:** `server/routes.ts` (POST /api/promocodes/validate)

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ú–æ–∂–Ω–æ –ø–µ—Ä–µ–±–∏—Ä–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥—ã –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

**–†–µ—à–µ–Ω–∏–µ:**
Rate limiting –Ω–∞ —ç—Ç–æ—Ç endpoint.

---

#### 10. –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:**
–ù–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
- –ü–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞
- –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª–µ–π
- –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
‚Üí –°–º. –§–∞–∑–∞ 5.1 (–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

#### 11. Email verification —Ç–æ–∫–µ–Ω—ã –Ω–µ –∏—Å—Ç–µ–∫–∞—é—Ç
**–§–∞–π–ª:** `server/routes.ts:136-167`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `verificationTokenExpires`, –Ω–æ —Ç–æ–∫–µ–Ω—ã –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

**–†–µ—à–µ–Ω–∏–µ:**
‚Üí –°–º. –§–∞–∑–∞ 4.4 (Cron –∑–∞–¥–∞—á–∏)

---

#### 12. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç HTTP Security Headers
**–§–∞–π–ª:** `server/index.ts`

**–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏:**
- `X-Content-Type-Options: nosniff`
- `X-Frame-Options: DENY`
- `X-XSS-Protection: 1; mode=block`
- `Strict-Transport-Security`
- `Content-Security-Policy`

**–†–µ—à–µ–Ω–∏–µ:**
‚Üí –°–º. –§–∞–∑–∞ 1.4

---

### üîµ –ù–ò–ó–ö–ò–ï –†–ò–°–ö–ò

#### 13. –ù–æ–º–µ—Ä–∞ –∑–∞–∫–∞–∑–æ–≤ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã
**–§–∞–π–ª:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è `order_number` –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
import { nanoid } from 'nanoid';

const orderNumber = `ORD-${new Date().getFullYear()}-${nanoid(8).toUpperCase()}`;
// –ü—Ä–∏–º–µ—Ä: ORD-2025-A3B7K9MN
```

---

#### 14. –ü–∞—Ä–æ–ª–∏ –Ω–µ –∏–º–µ—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
**–§–∞–π–ª:** `shared/schema.ts:536`

**–¢–µ–∫—É—â–µ–µ:**
```typescript
password: z.string().min(8, "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤")
```

**–õ—É—á—à–µ:**
```typescript
password: z.string()
  .min(8, "–ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤")
  .regex(/[A-Z]/, "–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –∑–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞")
  .regex(/[a-z]/, "–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Å—Ç—Ä–æ—á–Ω–∞—è –±—É–∫–≤–∞")
  .regex(/[0-9]/, "–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞")
```

---

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
**–ë–ª–æ–∫–∏—Ä—É–µ—Ç:** –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ —Å –æ–ø–ª–∞—Ç–æ–π –∏ –¥–æ—Å—Ç–∞–≤–∫–æ–π

**–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è MVP:**
- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ (300‚ÇΩ)
- –¢–æ–ª—å–∫–æ –æ–ø–ª–∞—Ç–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏
- –£–±—Ä–∞—Ç—å –≤—ã–±–æ—Ä —Å–ª—É–∂–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏

**–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**
‚Üí –§–∞–∑–∞ 4 (–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)

---

### 2. WebSocket —á–∞—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
**–ë–ª–æ–∫–∏—Ä—É–µ—Ç:** –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫—É

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –°–æ–æ–±—â–µ–Ω–∏—è broadcast –≤—Å–µ–º
- –ù–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ø–æ –¥–∏–∞–ª–æ–≥–∞–º
- –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
‚Üí –§–∞–∑–∞ 2.4

---

### 3. –ê–¥–º–∏–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—É—Å—Ç–∞
**–ë–ª–æ–∫–∏—Ä—É–µ—Ç:** –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
Endpoint `/api/admin/stats` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{}`

**–†–µ—à–µ–Ω–∏–µ:**
‚Üí –§–∞–∑–∞ 2.5

---

### 4. Frontend –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ API
**–ë–ª–æ–∫–∏—Ä—É–µ—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ú–Ω–æ–≥–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç mock –¥–∞–Ω–Ω—ã–µ
- –§–æ—Ä–º—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –∑–∞–ø—Ä–æ—Å—ã
- –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

**–†–µ—à–µ–Ω–∏–µ:**
‚Üí –§–∞–∑–∞ 2.6

---

### 5. –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
**–ë–ª–æ–∫–∏—Ä—É–µ—Ç:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ù–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω upload —Ñ–∞–π–ª–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
‚Üí –§–∞–∑–∞ 2.2

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

#### 1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ backend –Ω–∞ –º–æ–¥—É–ª–∏
**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
`server/routes.ts` —Å–æ–¥–µ—Ä–∂–∏—Ç 1200+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```
server/
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ auth.ts
‚îÇ   ‚îú‚îÄ‚îÄ products.ts
‚îÇ   ‚îú‚îÄ‚îÄ orders.ts
‚îÇ   ‚îú‚îÄ‚îÄ cart.ts
‚îÇ   ‚îú‚îÄ‚îÄ admin.ts
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îú‚îÄ‚îÄ auth.ts
‚îÇ   ‚îú‚îÄ‚îÄ validate.ts
‚îÇ   ‚îú‚îÄ‚îÄ upload.ts
‚îÇ   ‚îî‚îÄ‚îÄ errorHandler.ts
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ auth.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ order.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ payment.service.ts
‚îÇ   ‚îî‚îÄ‚îÄ delivery.service.ts
‚îî‚îÄ‚îÄ ...
```

---

#### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å env validation
**–§–∞–π–ª:** `server/env.ts` (—Å–æ–∑–¥–∞—Ç—å)

```typescript
import { z } from 'zod';

const envSchema = z.object({
  NODE_ENV: z.enum(['development', 'production', 'test']),
  PORT: z.string().default('5000'),
  DATABASE_URL: z.string().url(),
  JWT_SECRET: z.string().min(32),
  YUKASSA_SHOP_ID: z.string().optional(),
  YUKASSA_SECRET_KEY: z.string().optional(),
  CDEK_CLIENT_ID: z.string().optional(),
  CDEK_CLIENT_SECRET: z.string().optional(),
  EMAIL_HOST: z.string().optional(),
  EMAIL_PORT: z.string().optional(),
  EMAIL_USER: z.string().optional(),
  EMAIL_PASSWORD: z.string().optional(),
});

export const env = envSchema.parse(process.env);
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```typescript
import { env } from './env';

const JWT_SECRET = env.JWT_SECRET; // TypeScript –∑–Ω–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ string
```

---

#### 3. –î–æ–±–∞–≤–∏—Ç—å API –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// server/routes/v1/index.ts
export function registerV1Routes(app: Express) {
  app.use('/api/v1/auth', authRoutes);
  app.use('/api/v1/products', productRoutes);
  // ...
}
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç:
- –í–Ω–µ–¥—Ä—è—Ç—å breaking changes –±–µ–∑ –ø—Ä–æ–±–ª–µ–º
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ä—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ü–ª–∞–≤–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –Ω–æ–≤—ã–µ API

---

#### 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DTO (Data Transfer Objects)
**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
–°—É—â–Ω–æ—Å—Ç–∏ –∏–∑ –ë–î –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É –Ω–∞–ø—Ä—è–º—É—é.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// server/dto/user.dto.ts
export function toUserDto(user: User): UserDto {
  return {
    id: user.id,
    email: user.email,
    firstName: user.firstName,
    lastName: user.lastName,
    phone: user.phone,
    bonusBalance: user.bonusBalance,
    // –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º:
    // - passwordHash
    // - verificationToken
  };
}
```

---

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### 1. Database Connection Pool
**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```typescript
export const pool = new Pool({ connectionString: process.env.DATABASE_URL });
```

**–õ—É—á—à–µ:**
```typescript
export const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
  max: 20, // –º–∞–∫—Å–∏–º—É–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
  idleTimeoutMillis: 30000,
  connectionTimeoutMillis: 2000,
});
```

---

#### 2. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```bash
npm install redis
```

```typescript
// –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ä–µ–¥–∫–æ)
app.get('/api/categories', async (req, res) => {
  const cacheKey = 'categories:all';
  const cached = await redis.get(cacheKey);
  
  if (cached) {
    return res.json(JSON.parse(cached));
  }
  
  const categories = await storage.getCategories();
  await redis.set(cacheKey, JSON.stringify(categories), 'EX', 3600); // 1 —á–∞—Å
  
  res.json(categories);
});
```

---

#### 3. Eager Loading
**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
// N+1 query problem
const products = await storage.getProducts();
for (const product of products) {
  product.images = await storage.getProductImages(product.id); // N –∑–∞–ø—Ä–æ—Å–æ–≤!
}
```

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
const products = await db
  .select()
  .from(productsTable)
  .leftJoin(productImages, eq(productsTable.id, productImages.productId));

// –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤ –ø–∞–º—è—Ç–∏
const productsWithImages = groupByProduct(products);
```

---

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

#### 1. –î–æ–±–∞–≤–∏—Ç—å ESLint
**–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
npm install -D eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin
```

**.eslintrc.json:**
```json
{
  "extends": [
    "eslint:recommended",
    "plugin:@typescript-eslint/recommended"
  ],
  "parser": "@typescript-eslint/parser",
  "rules": {
    "no-console": "warn",
    "@typescript-eslint/no-explicit-any": "error",
    "@typescript-eslint/explicit-function-return-type": "warn"
  }
}
```

---

#### 2. –î–æ–±–∞–≤–∏—Ç—å Prettier
**–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
npm install -D prettier eslint-config-prettier
```

**.prettierrc:**
```json
{
  "semi": true,
  "trailingComma": "all",
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2
}
```

---

#### 3. –î–æ–±–∞–≤–∏—Ç—å Husky (pre-commit hooks)
**–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
npm install -D husky lint-staged

npx husky init
```

**.husky/pre-commit:**
```bash
#!/bin/sh
npm run check
npm run lint
```

**package.json:**
```json
{
  "scripts": {
    "lint": "eslint . --ext .ts,.tsx",
    "format": "prettier --write ."
  },
  "lint-staged": {
    "*.{ts,tsx}": [
      "eslint --fix",
      "prettier --write"
    ]
  }
}
```

---

### DevOps

#### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Docker –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
**docker-compose.yml:**
```yaml
version: '3.8'

services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_PASSWORD: password
      POSTGRES_DB: ecomarket
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7
    ports:
      - "6379:6379"

  app:
    build: .
    ports:
      - "5000:5000"
    environment:
      DATABASE_URL: postgresql://postgres:password@postgres:5432/ecomarket
      REDIS_URL: redis://redis:6379
    depends_on:
      - postgres
      - redis

volumes:
  postgres_data:
```

---

#### 2. Health Check Endpoint
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
app.get('/health', async (req, res) => {
  try {
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î
    await db.execute(sql`SELECT 1`);
    
    res.json({
      status: 'healthy',
      timestamp: new Date().toISOString(),
      database: 'connected',
    });
  } catch (error) {
    res.status(503).json({
      status: 'unhealthy',
      timestamp: new Date().toISOString(),
      database: 'disconnected',
      error: error.message,
    });
  }
});
```

---

#### 3. Graceful Shutdown
**server/index.ts:**
```typescript
const server = app.listen(port, () => {
  log(`serving on port ${port}`);
});

// Graceful shutdown
process.on('SIGTERM', async () => {
  console.log('SIGTERM received, closing server...');
  
  server.close(async () => {
    console.log('HTTP server closed');
    
    // –ó–∞–∫—Ä—ã—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î
    await pool.end();
    
    // –ó–∞–∫—Ä—ã—Ç—å WebSocket
    wss.close();
    
    console.log('All connections closed, exiting');
    process.exit(0);
  });
  
  // Force shutdown after 30 seconds
  setTimeout(() => {
    console.error('Forced shutdown after timeout');
    process.exit(1);
  }, 30000);
});
```

---

## –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏

### –ù–µ–¥–µ–ª—è 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å + Core —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
**–î–Ω–∏ 1-2:** –§–∞–∑–∞ 1 (–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)  
**–î–Ω–∏ 3-5:** –§–∞–∑–∞ 2 (Core —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π MVP —Å —Ä–∞–±–æ—Ç–∞—é—â–∏–º–∏ –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏

### –ù–µ–¥–µ–ª—è 2: UX + –ü–æ–ª–∏—Ä–æ–≤–∫–∞
**–î–Ω–∏ 1-3:** –§–∞–∑–∞ 3 (UX —É–ª—É—á—à–µ–Ω–∏—è)  
**–î–Ω–∏ 4-5:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ì–æ—Ç–æ–≤—ã–π –∫ –∑–∞–ø—É—Å–∫—É –ø—Ä–æ–¥—É–∫—Ç

### –ù–µ–¥–µ–ª—è 3+: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞)
**–§–∞–∑–∞ 4:** –ü–ª–∞—Ç–µ–∂–∏ –∏ –¥–æ—Å—Ç–∞–≤–∫–∞  
**–§–∞–∑–∞ 5:** –ü—Ä–æ–¥–∞–∫—à–Ω-–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: 60% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ MVP

**–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ:**
- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ë–∞–∑–æ–≤—ã–π API
- ‚úÖ Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–µ—Ä—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞:**
1. üî¥ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (JWT, CSRF, Rate Limiting)
2. üî¥ Email –æ—Ç–ø—Ä–∞–≤–∫–∞
3. üî¥ WebSocket —á–∞—Ç
4. üî¥ Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API

**–ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ, –Ω–æ –≤–∞–∂–Ω—ã–µ:**
- üü° –ü–ª–∞—Ç–µ–∂–∏ (–º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ: —Ç–æ–ª—å–∫–æ –æ–ø–ª–∞—Ç–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏)
- üü° –î–æ—Å—Ç–∞–≤–∫–∞ (–º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å)
- üü° –ê–¥–º–∏–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–ª–∞–Ω

**–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π MVP (1 –Ω–µ–¥–µ–ª—è):**
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ 8 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π (–§–∞–∑–∞ 1)
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å email –æ—Ç–ø—Ä–∞–≤–∫—É
3. –ü–æ—á–∏–Ω–∏—Ç—å WebSocket —á–∞—Ç
4. –ü–æ–¥–∫–ª—é—á–∏—Ç—å frontend –∫ API
5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ó–∞–ø—É—Å–∫ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏:**
- –¢–æ–ª—å–∫–æ –æ–ø–ª–∞—Ç–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏
- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ 300‚ÇΩ
- –ë–µ–∑ —á–∞—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (–¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ)

**–ü–æ—Å—Ç-–∑–∞–ø—É—Å–∫ (2-3 –Ω–µ–¥–µ–ª–∏):**
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ÆKassa
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –°–î–≠–ö/Boxberry
- –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- –ê–¥–º–∏–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ:**
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –¢–µ—Å—Ç—ã
- CI/CD
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

**–î–∞—Ç–∞ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞:** 16 –Ω–æ—è–±—Ä—è 2025  
**–ê–≤—Ç–æ—Ä:** Replit Agent  
**–í–µ—Ä—Å–∏—è:** 1.0
